name: Deploy site to gh-pages

on:
  push:
    branches: [ main ]
  # 可选： 手动触发
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository (use PAT)
        uses: actions/checkout@v4
        with:
          # 使用你在仓库 secrets 中添加的 PAT
          token: ${{ secrets.GH_PAGES_PAT }}
          # 不要让 checkout 持久化 GITHUB_TOKEN，这样 push 时不会被默认的 GITHUB_TOKEN 覆盖
          persist-credentials: false

      - name: Deploy to gh-pages (use PAT)
        uses: peaceiris/actions-gh-pages@v3
        with:
          # 使用同一个 PAT secret，peaceiris 会用它来 push
          github_token: ${{ secrets.GH_PAGES_PAT }}
          publish_branch: gh-pages
          publish_dir: ./
          allow_empty_commit: true